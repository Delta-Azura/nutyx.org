<h1> Produce a customised ISO</h1>
 <div class="note"><img alt="[NOTE IMPORTANT]" src="../graphics/note.gif"/>
  All the commands should be entered as root
 </div>

 <h2>Installation of a NuTyX system</h2>
  <h3>The "LFS" variable MUST be defined</h3>
   <p>
    In this demonstration the chroot will be in the &quot;/ISO-NuTyX&quot; directory, but you may choose a different name.
   <pre class="command"><kbd>export LFS=/ISO-NuTyX</kbd></pre>
  <h3>Make sure you have all the tools installed</h3>
   <p>
    If you are running a NuTyX system you can use:
   <pre class="command"><kbd>cards install git cdrtools syslinux libisoburn dosfstools</kbd></pre>
  <h3>Clone the "NuTyX" git repository</h3>
   <p>
    Change to the directory where you want to download a temporary NuTyX repository: e.g. `cd /mnt`
   <pre class="command"><kbd>git clone https://github.com/NuTyX/packages-x86_64</kbd></pre>
  <h3>Install the NuTyX base system</h3>
   <pre class="command"><kbd>install-nutyx</kbd></pre>
  <h3>Copy necessary files for the iso</h3>
   <pre class="command"><kbd>cp -av packages-x86_64/iso $LFS/ISO</kbd></pre>

  <h3>Enter the chroot</h3>
   <pre class="command"><kbd>install-nutyx -ec</kbd></pre>

 <h2>Create a NuTyX according to your needs</h2>
  <h3>About the locales</h3>
   <p>
    There is no need to install your own locale,
    indeed the command <b><i>cards upgrade</i></b> will automatically install them during post-configuration.
  <h3>Install a kernel</h3>
   <p>Your NuTyX needs a kernel.
      Please choose one from this list:
      <table>
     <caption>
     <EM>
      Kernels list.
     </EM>
     </caption>
     <tr class="sidebar">
      <th>
       Kernel Version
      <th>
       Name of the package to install
     <tr class="even">
      <td>
       4.9.x
      <td>
       kernel-49
     <tr class="odd">
      <td>
       4.14.x
      <td>
       kernel-414
     <tr class="even">
      <td>
       4.19.x
      <td>
       kernel-419
     <tr class="odd">
      <td>
       5.4.x
      <td>
       kernel-54
     <tr class="even">
      <td>
       5.10.x
      <td>
       kernel-510
     <tr class="odd">
      <td>
       latest
      <td>
       kernel
    </table>
   <p>
    For example, if you wish to install the LTS kernel 5.10.x
    <pre class="command"><kbd>get kernel-510</kbd></pre>

  <h3>Put the kernel and the initrd in the right place</h3>
   <pre class="command"><kbd>mkinitramfs $(basename /lib/modules/*) -nf</kbd></pre>

  <h3>Install the other init systems</h3>
   <p>
    Your NuTyX uses systemV by default.
    If you want to use systemD or runyx, then you need to install them.
    Either or both are possible:
    <pre class="command"><kbd>get systemd runyx</kbd></pre>

  <h3>Install packages for a RAID</h3>
   <p>
    If you intend to use RAID on your machine,
    install the package:
    <pre class="command"><kbd>get mdadm</kbd></pre>

  <h3>Firmwares</h3>
   <p>
    If you need firmwares for the proper functioning of the machine.
    install the package:
    <pre class="command"><kbd>get linux-firmware</kbd></pre>
   <p>
    This package contains over 2000 firmwares and use 500 Mbytes in space on the hard drive.

  <h3>Install the package to encrypt partitions</h3>
   <p>
    If you want to encrypt your partitions, install:
    <pre class="command"><kbd>get cryptsetup</kbd></pre>

  <h3>Install DHCP service</h3>
   <p>
    If you not plan to install network-manager package and not want to use a static IP adress.
    You want to connect to a DHCP server, you then need a dhcpcd package:
    <pre class="command"><kbd>get dhcpcd</kbd></pre>

  <h3>Install the EFI's installation packages</h3>
   <p>
    If your machine supports UEFI, it's a good idea to add the packages for the management of this one:
   <pre class="command"><kbd>get efibootmgr dosfstools</kbd></pre>

  <h3>Install wifi</h3>
   <p>
    If your machine is able to connect to a wireless network,
    install at least the following packages to be able to benefit from it:
   <pre class="command"><kbd>get wireless-tools wpa-supplicant</kb></pre>

  <h3>Mouse support</h3>
   <p>
    If you want to use the mouse in the console, install the packages:
    <pre class="command"><kbd>get gpm gpm.service</kb></pre>

  <h3>Install all of the extra packages you want</h3>
   <pre class="command"><kbd>get mate lightdm firefox ...</kb></pre>

  <h3>Flush the binary archives</h3>
   <pre class="command"><kbd>cards purge</kbd></pre>

 <h2>Generate the ISO</h2>
  <h3>Generate the squashfs files </h3>
   <pre class="command"><kbd>for dir in opt bin etc lib lib64 root run sbin usr var home
do
  [ -f /ISO/boot/$dir.squashfs ] && rm /ISO/boot/$dir.squashfs
  mksquashfs /$dir /ISO/boot/$dir.squashfs
done</kbd></pre>

  <h3>Quit the NuTyX chroot</h3>
   <pre class="command"><kbd>exit</kbd></pre>
  <h3>Generate the ISO</h3>
   <pre class="command"><kbd>bash packages-x86_64/scripts/mkiso $(basename $LFS) $(basename $LFS/lib/modules/*)</kbd></pre>
 <h2>Create a bootable USB-Stick</h2>
  <p>
   Insert your USB-Stick and check the disk. Run:
  <pre class="command"><kbd>lsblk -S</kbd></pre>
  <pre class="output">
NAME HCTL       TYPE VENDOR   MODEL                 REV SERIAL           TRAN
sda  0:0:0:0    disk ...
sdb  2:0:0:0    disk ...
sdc  8:0:0:0    disk TDKMedia Trans-It_Drive       PMAP 07991E033A9CAF0E usb</pre>
  <p>
   Create a bootable USB-Stick specifying the correct filename and disk (replace sdX with your USB disk)
  <div class="important"><img alt="[Important]" src="../graphics/caution.gif" >
   The following command will delete all data that is on the USB key.
  </div>
  <pre class="command"><kbd>dd if=$LFS/NuTyX_x86_64-ISO-MINI.iso of=/dev/sdX status=progress
sync</kbd></pre>

 <h2>Conclusion</h2>
  <p>
   The size should not be greater than 500 MB if you didn't add any optional packages.
   You will find the iso image in the $LFS directory.
   <pre class="command"><kbd>ls $LFS</kbd></pre>
   <pre class="output">bin   dev  home  lib  NuTyX_x86_64-20190626.iso     proc  run   srv  tmp  var
boot  etc  ISO   mnt  NuTyX_x86_64-20190626.md5sum  root  sbin  sys  usr</pre>
